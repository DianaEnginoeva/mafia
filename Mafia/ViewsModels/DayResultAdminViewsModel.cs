using System; using System.Windows.Input; using Newtonsoft.Json; using Xamarin.Forms;  namespace Mafia { 	public class DayResultAdminViewsModel : ContentPage 	{ 		public ICommand StartNight { get; set; } 		private readonly IGameService _gameService; //!!  		private Page _page; 		public int i;  		public DayResultAdminViewsModel(Page page, IGameService gameService) //!!
		{ 			var i = 0; 			_gameService = gameService; //!! 			_gameService.OnReceive += GameService_OnReceive; //!! 			StartNight = new Command(OpenNightPage); 		}   		private void GameService_OnReceive(object sender, Message e) //принимает данные сервера
		{ 			Device.BeginInvokeOnMainThread(async () => 			{ 				try 				{ 					if ((e.UserMessage == "Night") && (i == 0)) 					{ 						var json = "{\"UserName\":\"" + GameService.Instance._userName + "\"} "; // получаем роль 						var response = await DataService.GetInstance().GetRole(json); 						var answer = JsonConvert.DeserializeObject<RoleModel>(response); 						i++; 						if (answer.role == 0) 						{ 							var app = (App)Application.Current; // без вовзврата на  							app.MainPage = new NavigationPage(new NightForNoMafiaPage()); // предыдущую страницу
						} 						else 						{ 							var app = (App)Application.Current; // без вовзврата на  							app.MainPage = new NavigationPage(new NightPage()); // предыдущую страницу
						} 					} 				} 				catch (Exception k) 				{ 				} 			}); 		}  		private async void OpenNightPage() 		{

			var json = "{\"UserName\":\"" + GameService.Instance._userName + "\"} "; // получаем роль 			var response = await DataService.GetInstance().GetRole(json); 			var answer = JsonConvert.DeserializeObject<RoleModel>(response); 			if (answer.role == 0) 			{ 				var app = (App)Application.Current; // без вовзврата на  				app.MainPage = new NavigationPage(new NightForNoMafiaPage()); // предыдущую страницу
			} 			else 			{ 				var app = (App)Application.Current; // без вовзврата на  				app.MainPage = new NavigationPage(new NightPage()); // предыдущую страницу
			} 		} 	} }   