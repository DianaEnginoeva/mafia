using System; using System.Collections.Generic; using System.Collections.ObjectModel; using System.Threading.Tasks; using Newtonsoft.Json; using Xamarin.Forms;  namespace Mafia { 	public class DayResultViewsModel : ContentPage 	{ 		private readonly IGameService _gameService; //!!  		private Page _page; 		public int i = 0; 		public DayResultViewsModel(Page page, IGameService gameService) //!!
		{ 			var i = 0; 			_gameService = gameService; //!! 			_gameService.OnReceive += GameService_OnReceive; //!!
		}   		private void GameService_OnReceive(object sender, Message e) //принимает данные сервера
		{ 			Device.BeginInvokeOnMainThread(async () => 			{ 				try 				{ 					if ((e.UserMessage == "Night") && (i == 0)) 					{ 						i++; 						var json = "{\"UserName\":\"" + GameService.Instance._userName + "\"} "; // получаем роль 						var response = await DataService.GetInstance().GetRole(json); 						var answer = JsonConvert.DeserializeObject<RoleModel>(response);  						if (answer.role == 0) 						{ 							var app = (App)Application.Current; // без вовзврата на  							app.MainPage = new NavigationPage(new NightForNoMafiaPage()); // предыдущую страницу
						} 						else 						{ 							var app = (App)Application.Current; // без вовзврата на  							app.MainPage = new NavigationPage(new NightPage()); // предыдущую страницу
						} 					} 				} 				catch (Exception k) 				{ 				} 			}); 		} 	} }   